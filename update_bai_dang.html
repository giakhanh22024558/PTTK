<!DOCTYPE html>
{% load static %}

<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chi ti·∫øt b√†i ƒëƒÉng thanh l√Ω</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <link href="./custom.css" rel="stylesheet">
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light px-3">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <img src="{% static 'images/logo.png' %}" alt="Logo" width="40" height="40" class="d-inline-block align-text-top">
      Thanh L√Ω & G√¢y Qu·ªπ
    </a>

    <form class="d-flex mx-auto w-50" action="/search/" method="get">
      <input class="form-control me-2" type="search" name="q" placeholder="T√¨m s·∫£n ph·∫©m ho·∫∑c s·ª± ki·ªán..." aria-label="Search">
      <button class="btn btn-outline-success" type="submit">T√¨m</button>
    </form>

    <div>
      {% if request.user.is_authenticated %}
        <span class="me-2">Xin ch√†o, {{ request.user.username }}</span>
        <!-- N√∫t ƒëƒÉng xu·∫•t -->
        <a href="{% url 'logout' %}" class="btn btn-outline-danger">ƒêƒÉng xu·∫•t</a>
        
        <!-- Bi·ªÉu t∆∞·ª£ng th√¥ng b√°o -->
        <a href="#" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#notificationModal">
          <i class="bi bi-bell"></i> Th√¥ng b√°o
        </a>
      {% else %}
        <a href="#" class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#loginModal">ƒêƒÉng nh·∫≠p</a>
      {% endif %}
    </div>
  </div>
</nav>

<!-- Modal ƒêƒÉng Nh·∫≠p -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" method="post" action="{% url 'login' %}">
      {% csrf_token %}
      <div class="modal-header">
        <h5 class="modal-title">ƒêƒÉng nh·∫≠p</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
      </div>
      <div class="modal-body">
        {% if login_failed %}
        <div class="alert alert-danger">Th√¥ng tin ƒëƒÉng nh·∫≠p kh√¥ng ch√≠nh x√°c. Vui l√≤ng th·ª≠ l·∫°i.</div>
        {% endif %}
        <div class="mb-3">
          <label for="username" class="form-label">T√™n ƒëƒÉng nh·∫≠p</label>
          <input type="text" class="form-control" id="username" name="username" required>
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">M·∫≠t kh·∫©u</label>
          <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <div class="mb-2">
          <a href="/password-reset/">Qu√™n m·∫≠t kh·∫©u?</a>
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">ƒêƒÉng nh·∫≠p</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Th√¥ng b√°o -->
<div class="modal fade" id="notificationModal" tabindex="-1" aria-labelledby="notificationModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Th√¥ng b√°o</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
      </div>
      <div class="modal-body">
        <ul>
          {% for notification in notifications %}
          <li>
            <strong>{{ notification.title }}</strong>
            <p>{{ notification.content }}</p>
            <small>{{ notification.noti_time }}</small>
          </li>
          {% empty %}
          <p>Kh√¥ng c√≥ th√¥ng b√°o m·ªõi.</p>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<div class="container mt-5 mb-5">
  <h2 class="mb-4">C·∫≠p nh·∫≠t B√†i ƒëƒÉng</h2>

  <form id="updateThanhLyForm">
    <div class="row">
      <!-- Input Section: now on the LEFT -->
      <div class="col-md-7">
        <div class="mb-3">
          <label class="form-label">Ng√†y t·∫°o</label>
          <input type="text" class="form-control" name="date_created" value="10/05/2025" readonly />
        </div>
        <div class="mb-3">
          <label class="form-label">Ti√™u ƒë·ªÅ</label>
          <input type="text" class="form-control" name="title" value="B√†i ƒëƒÉng thanh l√Ω 1" />
        </div>
        <div class="mb-3">
          <label class="form-label">N·ªôi dung</label>
          <textarea class="form-control" name="content" rows="3">ƒê√¢y l√† n·ªôi dung chi ti·∫øt c·ªßa b√†i thanh l√Ω.</textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Danh m·ª•c</label>
          <select class="form-select" name="category">
            <option value="ƒê·ªì ƒëi·ªán t·ª≠" selected>ƒê·ªì ƒëi·ªán t·ª≠</option>
            <option value="ƒê·ªì gia d·ª•ng">ƒê·ªì gia d·ª•ng</option>
            <option value="S√°ch">S√°ch</option>
            <option value="Th·ªùi trang">Th·ªùi trang</option>
            <option value="Kh√°c">Kh√°c</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">T√™n s·∫£n ph·∫©m</label>
          <input type="text" class="form-control" name="product_name" value="Tai nghe Sony" />
        </div>
        <div class="mb-3">
          <label class="form-label">Th·ªùi gian ƒë√£ s·ª≠ d·ª•ng</label>
          <input type="text" class="form-control" name="product_used_period" value="6 th√°ng" />
        </div>
        <div class="mb-3">
          <label class="form-label">Gi√° mong mu·ªën (VND)</label>
          <input type="number" class="form-control" name="price" value="500000" />
        </div>
        <div class="mb-3">
          <label class="form-label">Lo·∫°i b√†i ƒëƒÉng</label>
          <select class="form-select" name="type_post" readonly disabled>
            <option value="Thanh l√Ω" selected>Thanh l√Ω</option>
            <option value="Trao ƒë·ªïi">Trao ƒë·ªïi</option>
          </select>
        </div>
      </div>

      <!-- Image + Requesters Section: now on the RIGHT -->
      <div class="col-md-5 d-flex flex-column">
        <!-- Image Upload -->
        <div class="mb-3">
          <label class="form-label">H√¨nh ·∫£nh s·∫£n ph·∫©m</label>
          <input type="file" class="form-control" name="product_image" />
          <img src="/static/images/thanhly1.jpg" class="img-fluid mt-3" alt="H√¨nh ·∫£nh hi·ªán t·∫°i">
        </div>

        <!-- Danh s√°ch ng∆∞·ªùi y√™u c·∫ßu thanh l√Ω -->
        <div class="card mt-3 flex-grow-1 d-flex flex-column" style="max-height: 100%; overflow-y: auto;">
          <div class="card-header bg-light fw-bold">
            Danh s√°ch ng∆∞·ªùi y√™u c·∫ßu thanh l√Ω
          </div>
          <div class="p-3 border-bottom">
            <input
              type="text"
              class="form-control"
              placeholder="T√¨m ki·∫øm theo t√™n ho·∫∑c email..."
              id="requesterSearch"
              oninput="filterRequesters()"
            />
          </div>
          <div class="card-body p-2" id="requesterList" style="overflow-y: auto; max-height: 500px;">
            <!-- Sample Requester Card -->
            <div class="card mb-2 requester-item">
              <div class="card-body d-flex justify-content-between align-items-center p-2">
                <div>
                  <h6 class="mb-0 requester-name">Nguy·ªÖn VƒÉn A</h6>
                  <small class="requester-email">nguyenvana@example.com</small>
                </div>
                <button class="btn btn-sm btn-success btn-confirm-price">X√°c nh·∫≠n</button>
              </div>
            </div>
            <div class="card mb-2 requester-item">
              <div class="card-body d-flex justify-content-between align-items-center p-2">
                <div>
                  <h6 class="mb-0 requester-name">Tr·∫ßn Th·ªã B</h6>
                  <small class="requester-email">tranthib@example.com</small>
                </div>
                <button class="btn btn-sm btn-success btn-confirm-price">X√°c nh·∫≠n</button>
              </div>
            </div>
            <!-- More requester cards can be added here -->
          </div>
        </div>
      </div>
    </div>

    <div class="mt-4">
      <a href="javascript:history.back()" class="btn btn-secondary">Quay l·∫°i</a>
      <button type="submit" class="btn btn-success">L∆∞u thay ƒë·ªïi</button>
    </div>
  </form>
</div>

<div class="modal fade" id="finalPriceModal" tabindex="-1" aria-labelledby="finalPriceModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" id="finalPriceForm">
      <div class="modal-header">
        <h5 class="modal-title">X√°c nh·∫≠n thanh l√Ω</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
      </div>
      <div class="modal-body">
        
        <!-- üë§ Selected User Info -->
        <div class="">
          <label class="form-label">Ng∆∞·ªùi nh·∫≠n thanh l√Ω</label>
          <div id="chosenUserInfo" class="border rounded p-2 bg-light">
            <div><strong>T√™n:</strong> <span id="chosenUserName">--</span></div>
            <div><strong>Email:</strong> <span id="chosenUserEmail">--</span></div>
          </div>
        </div>

        <!-- ‚ùì Confirmation Prompt -->
        <p class="text-danger fw-bold mt-3">
          B·∫°n c√≥ ch·∫Øc ƒë√¢y l√† ng∆∞·ªùi b·∫°n ƒë√£ thanh l√Ω? <br>
          Vui l√≤ng nh·∫≠p gi√° tr·ªã trao ƒë·ªïi b√™n d∆∞·ªõi.
        </p>

        <!-- üíµ Final Price Input -->
        <div class="mb-3">
          <label for="finalPrice" class="form-label">Gi√° tr·ªã trao ƒë·ªïi (VND)</label>
          <input type="number" class="form-control" id="finalPrice" name="finalPrice" required placeholder="Nh·∫≠p gi√° tr·ªã trao ƒë·ªïi...">
        </div>

        <!-- üïµÔ∏è Hidden User ID -->
        <input type="hidden" id="chosenUserId" name="userId">
      </div>

      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">X√°c nh·∫≠n</button>
      </div>
    </form>
  </div>
</div>

  
<!-- Footer -->
<footer class="bg-light text-center text-muted py-3 mt-5">
    <div>¬© 2025 Trang Trao ƒê·ªïi & Quy√™n G√≥p | Li√™n h·ªá: contact@example.com</div>
</footer>
  
<script>
    function toggleCategories() {
        const el = document.getElementById("all-categories");
        el.style.display = el.style.display === "none" ? "block" : "none";
    }

    document.getElementById("updateThanhLyForm").addEventListener("submit", function(e) {
      e.preventDefault();
      alert("D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t (demo).");
      // You can send data using fetch/AJAX here
    });

    document.querySelectorAll('.btn-confirm-price').forEach(button => {
    button.addEventListener('click', function (e) {
      e.preventDefault();

      // Optionally, get requester info here:
      const card = this.closest('.requester-item');
      const name = card.querySelector('.requester-name')?.textContent;
      const email = card.querySelector('.requester-email')?.textContent;

      // Set data in modal if needed
      // document.getElementById('someFieldInModal').value = name;

      const modal = new bootstrap.Modal(document.getElementById('finalPriceModal'));
      modal.show();
    });
  });

</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

